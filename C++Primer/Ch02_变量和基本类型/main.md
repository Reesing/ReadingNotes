# 第二章 变量和基本类型

## 2.1 基本内置类型

### 2.1.1 算术类型

- 算术类型（arithmetic type）分两类
    - 整型（integral type）
        - **字符** 和 **布尔类型**
        - 其他整形（见 [带符号类型和无符号类型](#unsigned)）
    - 浮点型

- 算术类型的尺寸（即数据所占 **byte** 数量）在不同机器上有所差别。
    - 字节（byte） = 可寻址的最小内存块
    - 字（word）= 存储的基本单元，通常由几个字节组成
    - 一个字节（byte）至少要能容纳机器基本字符符集中的字符
        - `char` 大小 = 一个机器字节（byte）
    - **1 byte = 8 bits, word = 4(or 8) bytes = 32(or 64) bits**
    - 内存中每个byte与被称为地址（address）的数字关联起来
        - 为了明确内存中某地址的含义，**必须首先知道存储在该地址的数据类型**
        - 数据类型决定了数据所占 bits 数，以及如何解释这些 bits 的内容

- 算术类型最小尺寸

    类型|最小尺寸|<center>说明</center>
    :-:|:-:|:--
    `bool`| 未定义|-
    `char`| 8位 | 应确保可以存放 **机器基本字符集** 中任意字符<br>`char` 大小 = 一个机器字节（byte）
    `wchar_t`| 16位 | 应确保可以存放 **机器最大扩展字符集** 中任意字符
    `char16_t`| 16位 |为 **Unicode字符** 集服务
    `char32_t`| 32位|为 **Unicode字符** 集服务
    `short`| 16位|-
    `int`| 16位| `int` 至少和 `short` 一样大
    `long`| 32位| `long` 至少和 `int` 一样大
    `long long`| 64位| `long long` 至少和 `long` 一样大
    `float`| 6位有效数字 | `float` = 1 word = 4 bytes = 32 bits
    `double`| 10位有效数字 | `double` = 2 words = 8 bytes = 64 bits
    `long double`|10位有效数字 |`long double` = 3(or 4) words = 12(or 16) bytes = 96(or 128) bits

- <a name="unsigned">带符号类型和无符号类型</a>
    - 其他整形
        - 带符号的 `signed`
            - 可以表示正数、负数或0
            - `int`，`short`，`long`，`long long`
        - 无符号的 `unsigned`
            - 仅能表示大于等于0的值
            - `unsigned int`（可缩写为 `unsigned`），`unsigned short`，`unsigned long`，`unsigned long long`
    - 字符型
        - `char`
            - `char` != `signed char`
        - `signed char`
        - `unsigned char`
    - 如何选择类型？
        - C++ 的设计准则之一是**尽可能地接近硬件**
        - 当明确知道不可能为负时，用 `unsigned`
        - 在算术表达式中，不要使用 `bool` 或 `char`
            - 因为随机器不同，`char` 类型有可能是 `signed`，也可能是 `unsigned`，进行运算特别容易出问题
        - 执行浮点数运算用 `double`

### 2.1.2 类型转换

- 若使用了一种类型而其实应取另一种类型时，程序会自动进行类型转换。类型所能表示的值的范围决定了转换的过程
    ```cpp
    // 以下假设 char 占 8 bits
    unsigned char c = -1; // unsigned char 取值范围为 0~255，因此c的值为255
    signed char c2 = 256; // signed char 取值范围为 -127~127, 因此 c2 的值未定义
    ```
    - 当赋给 `unsigned` 类型一个超出表示范围的值时，结果是初始值对 `unsigned` 类型表示**数值总数取模后的余数**
    - 当赋给 `signed` 类型一个起来表示范围的值时，结果是**未定义的**（undefined），程序可能继续工作，或崩溃，或生成垃圾数据

- 含有无符号类型的表达式
    - **算术表达式中既有 `unsigned` 数又有 `int` 时，`int` 值会转换为 `unsigned`**
        ```cpp
        // 假设 int 占 32 bits
        unsigned u = 10;
        int i = -42;
        std::cout << i + i << std::endl; // 输出 -84, 正常
        std::cout << u + i << std::endl; // 输出 4294967264 = (2^32-42) + 10
        ```
    
    - 若从 `unsigned` 中减去一个数时，必须确保结果非负，否则会取模
        - **会关系到循环的写法！**

    - 不要滥用 `unsigned` 和 `signed` 类型！

### 2.1.3 字面值常量（literal）

- 整型和浮点型字面值
    - 整型字面值可以写作十、八、十六进制数形式
        - 八进制以 `0` 开头
        - 十六进制以 `0x` 或 `0X` 开头
    - 浮点型字面值表现为小数或以科学计数法表示的指数
        - 指数部分用 `E` 或 `e` 标识，如 `3.141E0`，`1e3`
        - 浮点型字面值默认是 `double`

- 字符和字符串字面值
    - `char` 型字面值：由**单引号**括起来的一个字符，如 `'a'`
    - 字符串型字面值：**双引号**括起来的零个或多个字符，如 `"Hello world!"`
        - 实质上是由常量字符构成的**数组**（array）
        - 编译器在每个字符串的结尾处添加一个**空字符** `'\0'`
        - 所以，**字符串字面值的实际长度 = 其内容 + 1**
    - 若两个字符串字面值相邻且仅由**空格**、**缩进**或**换行符**分隔，则它们实际上是一个整体
        ```cpp
        // 以下两个语句等价
        std::cout << "Part 1 "
                     "Part 2" << std::endl;
        std::cout << "Part 1 " "Part 2" << std::endl;
        std::cout << "Part 1 Part 2" << std::endl;
        ``` 

- 转义序列
    - 有两类字符不能直接使用，要使用转义序列（escape sequence）
        - 不可打印（nonprintable）字符，这些字符没有可视的图符，如退格等
        - 在C++中有特殊含义的字符，如单引号、双引号、问号、反斜线等

        符号|转义序列|符号|转义序列|符号|转义序列
        :-:|:-:|:-:|:-:|:-:|:-:
        换行符|`\n`|横向制表符|`\t`|报警符|`\a`
        纵向制表符|`\v`|退格符|`\b`|双引号|`\"`
        反斜线|`\\`|问号|`\?`|单引号|`\'`
        回车符|`\r`|进纸符|`\f`
    
    - 泛化的转义序列
        - `\x` 后加一个或多个十六进制的数字，要用到 `\x`后的**所有数字**
        - `\` 后加1-3个八进制数字，只算 `\` 后的**最多三个数字**
        - 示例：
            `\0` 空字符，`\12` 换行符，`x4d` 字符 `M`

- 指定字面值的类型
    - 通过添加前缀的后缀，可以改变整形、浮点型和字符型字面值的默认类型
    - 字符和字符串字面值

        前缀|含义|类型|说明|举例
        :-:|:-:|:-:|:-:|:-:
        `u`|Unicode 16字符|`char16_t`|-|`u'a'`
        `U`|Unicode 32字符|`char32_t`|-|`U'b'`
        `L`|宽字符|`wchar_t`|-|`L'c'`
        `u8`|UTF-8|`char`|仅用于*字符串字面常量*<br>UTF-8用8位编码一个Unicode字符|`u8"hi!"`
    
    - 整型字面值
        后缀|类型|说明|举例
        :-:|:-:|:-:|:-:
        `u` / `U`|`unsigned`|-|`10ULL`：无符号整型字面值，<br>类型是 `unsigned long long`
        `l` / `L`|`long`|小写字母 `l` 与数字 `1` 太容易混淆，<br>所以*一般使用大写字母* `L`|-
        `ll` / `LL`|`long long`|-|-

    - 浮点型字面值
        后缀|类型|说明|举例
        :-:|:-:|:-:|:-:
        `f` / `F`|`float`|-|`1E-3F`：单精度浮点型字面值，类型是 `float`
        `l` / `L`|`long double`|-|`3.14L`：扩展精度浮点型字面值，<br>类型是 `long double`

    - 布尔字面值和指针字面值
        - 布尔字面值：`true`，`false`
        - 指针字面值：`nullptr`

## 2.2 变量

C++中每个变量都有其数据类型，数据类型决定着其
- 所占内存空间的大小和布局方式
- 该空间能存储的值的范围
- 变量能参与的运算

### 2.2.1 变量定义

- 变量定义的基本形式：
    - 类型说明符（type specifier）+ 由一个或多个变量名组成的列表（变量名以逗号分隔）+ 分号（结束）

- *对象* ：指一块能存储数据并具有某种类型的内存空间

- 初始值
    - 在同一条定义语句中，可以用先定义的变量值去初始化后定义的其他变量
    - 在C++中，**【初始化】与【赋值】是两个完全不同的操作**
        - 初始化是创建变量时赋予其一个初始值
        - 赋值是把对象的当前值除去，以一个新值替代

- 列表初始化（list initialization）
![](../figure/cpp11.png)

    - 用花括号初始化变量
        ```cpp
        //下列4条语句等效
        int i = 0;
        int i = {0};
        int i{0};
        int i(0);
        ```

